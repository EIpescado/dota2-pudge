<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pers.yurwisher.dota2.pudge.system.mapper.MenuMapper">

    <select id="get" resultType="pers.yurwisher.dota2.pudge.system.pojo.vo.MenuVo">

    </select>
    <select id="getUserMenus" resultType="pers.yurwisher.dota2.pudge.system.entity.Menu">
        SELECT m.* from user_role_relation r
        INNER JOIN system_role sr ON sr.id = r.role_id
        INNER JOIN role_menu_relation mr on mr.role_id = sr.id
        INNER JOIN menu m ON m.id = mr.menu_id
        where r.user_id = #{userId} AND sr.enabled = 1 AND m.enabled = 1
        GROUP BY m.id
        ORDER BY m.menu_sort
    </select>
    <select id="getUserMenuTreeNodes" resultType="pers.yurwisher.dota2.pudge.system.pojo.tree.MenuTreeNode">
        SELECT
            m.id,m.title,m.name,m.menu_sort,m.component,m.path,
            m.type,m.icon,m.cache,m.hidden,m.pid,m.i_frame
        FROM
            user_role_relation r
        INNER JOIN system_role sr ON sr.id = r.role_id
        INNER JOIN role_menu_relation mr ON mr.role_id = sr.id
        INNER JOIN menu m ON m.id = mr.menu_id
        WHERE
            r.user_id = #{userId} AND m.type in (0,1)
        AND sr.enabled = 1
        AND m.enabled = 1
        GROUP BY
            m.id
        ORDER BY
            m.menu_sort
    </select>
    <select id="getUserButtonNodes" resultType="pers.yurwisher.dota2.pudge.system.pojo.tree.ButtonNode">
        SELECT
            m.id,m.title,m.menu_sort, m.type,m.icon,m.click,m.pid
        FROM
            user_role_relation r
        INNER JOIN system_role sr ON sr.id = r.role_id
        INNER JOIN role_menu_relation mr ON mr.role_id = sr.id
        INNER JOIN menu m ON m.id = mr.menu_id
        WHERE
            r.user_id = #{userId} AND m.type = 2
        AND sr.enabled = 1
        AND m.enabled = 1
        GROUP BY
            m.id
        ORDER BY
            m.menu_sort
    </select>

</mapper>
